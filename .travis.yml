language: python
python: 
    - "3.8"
services: 
    - docker 
#Only trigger Travis when pushed to master branch:
branches: 
    only: 
        - master
before_install:
    #Docker
    #Build image and run container
    #This can be moved to script if we want to see status for the build and run
    - cd app
    
    #- docker build -t "test_app_image" . 
    #- docker run -d -p 3000:5000 --name test_app_container test_app_image 
    
    #With docker-compose: 
    - docker-compose up -d --build #Build to make sure the image is always built
    - docker ps
    - cd -

#First main phase is install
install:
    - pip install -r requirements.txt

#Second main phase is script
#This is where Travis tests and runs code
script:
#Run code involving content of code:
    - python -m unittest tests/test_structure.py
    - python -m unittest tests/test_content.py 
    #Simple python script can be run like this: 
    #- python firsttest.py
    #Running all tests in a package: 
    # - python -m unittest discover tests 


    #Tests involving the running of web app
    - python -m unittest tests/test_running.py

    #Stop and remove the running container
    - cd app
    - docker ps
    - docker stop $(docker ps -q -f "name=app_container")
    - docker ps

    - docker container rm $(docker ps -a -q -f "name=app_container") #Removes the container
    - docker image rm app_image:test #Removes the build image. 
    - cd -

#Additional actions?
#after_success:
#after_failure:
#deploy: